//Copyright 2012, etc.

/**
 * almond 0.1.2 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

!function(e,t){e.oxml=function(){var e,t,n;return function(r){function o(e,t){var n,r,o,a,s,l,i,u,c,f,d=t&&t.split("/"),h=m.map,p=h&&h["*"]||{};if(e&&"."===e.charAt(0)&&t){for(d=d.slice(0,d.length-1),e=d.concat(e.split("/")),u=0;f=e[u];u++)if("."===f)e.splice(u,1),u-=1;else if(".."===f){if(1===u&&(".."===e[2]||".."===e[0]))return!0;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}if((d||p)&&h){for(n=e.split("/"),u=n.length;u>0;u-=1){if(r=n.slice(0,u).join("/"),d)for(c=d.length;c>0;c-=1)if((o=h[d.slice(0,c).join("/")])&&(o=o[r])){a=o,s=u;break}if(a)break;!l&&p&&p[r]&&(l=p[r],i=u)}!a&&l&&(a=l,s=i),a&&(n.splice(0,s,a),e=n.join("/"))}return e}function a(e,t){return function(){return d.apply(r,y.call(arguments,0).concat([e,t]))}}function s(e){return function(t){return o(t,e)}}function l(e){return function(t){h[e]=t}}function i(e){if(p.hasOwnProperty(e)){var t=p[e];delete p[e],v[e]=!0,f.apply(r,t)}if(!h.hasOwnProperty(e))throw new Error("No "+e);return h[e]}function u(e,t){var n,r,a=e.indexOf("!");return-1!==a?(n=o(e.slice(0,a),t),e=e.slice(a+1),r=i(n),e=r&&r.normalize?r.normalize(e,s(t)):o(e,t)):e=o(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function c(e){return function(){return m&&m.config&&m.config[e]||{}}}var f,d,h={},p={},m={},v={},y=[].slice;f=function(e,t,n,o){var s,f,d,m,y,g,x=[];if(o=o||e,"function"==typeof n){for(t=!t.length&&n.length?["require","exports","module"]:t,g=0;g<t.length;g++)if(y=u(t[g],o),"require"===(d=y.f))x[g]=a(e);else if("exports"===d)x[g]=h[e]={},s=!0;else if("module"===d)f=x[g]={id:e,uri:"",exports:h[e],config:c(e)};else if(h.hasOwnProperty(d)||p.hasOwnProperty(d))x[g]=i(d);else if(y.p)y.p.load(y.n,a(o,!0),l(d),{}),x[g]=h[d];else if(!v[d])throw new Error(e+" missing "+d);m=n.apply(h[e],x),e&&(f&&f.exports!==r&&f.exports!==h[e]?h[e]=f.exports:m===r&&s||(h[e]=m))}else e&&(h[e]=n)},e=t=d=function(e,t,n,o){return"string"==typeof e?i(u(e,t).f):(e.splice||(m=e,t.splice?(e=t,t=n,n=null):e=r),t=t||function(){},o?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},15),d)},d.config=function(e){return m=e,d},n=function(e,t,n){t.splice||(n=t,t=[]),p[e]=[e,t,n]},n.amd={jQuery:!0}}(),n("build/almond",function(){}),n("fileHandler",[],function(){"use strict";return{createFile:function(){if(window.JSZip){var e=new JSZip,t={_zip:e};return t.addFile=function(t,n,r){var o;r&&(o=e.folder(r)),(o||e).file(n,t)},t.saveFile=function(t,n){return e.generateAsync({type:"blob"}).then(function(e){try{if(window.saveAs)return saveAs(e,t);var r=window.URL.createObjectURL(e),o=document.createElement("a");if(o.setAttribute("href",r),o.setAttribute("download",t),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),n)n();else if("undefined"!=typeof Promise)return new Promise(function(e,t){e()})}catch(e){if(n)n("Err: Not able to create file object.");else if("undefined"!=typeof Promise)return new Promise(function(e,t){t("Err: Not able to create file object.")})}})},t}}}}),n("oxml_rels",[],function(){"use strict";var e=function(e,t,n,r){r.relations.push({Id:e,Type:t,Target:n})},t=function(e){var t,n='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">';for(t=0;t<e.relations.length;t++){var r=e.relations[t];n+='<Relationship Id="'+r.Id+'" Type="'+r.Type+'" Target="'+r.Target+'"/>'}return n+="</Relationships>"},n=function(e,n){var r=t(n);e.addFile(r,n.fileName,n.folderName)},r=function(e){e.relations=null,delete e.relations,e.addRelation=null,delete e.addRelation,e.generateContent=null,delete e.generateContent,e.attach=null,delete e.attach};return{createRelation:function(o,a){var s={relations:[],fileName:o,folderName:a};return s.addRelation=function(t,n,r){e(t,n,r,s)},s.generateContent=function(){return t(s)},s.attach=function(e){return n(e,s)},s.destroy=function(){r(s)},s}}}),n("oxml_content_types",[],function(){"use strict";var e=function(e){var t,n='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">';for(t=0;t<e.contentTypes.length;t++){var r=e.contentTypes[t];n+="<"+r.name+' ContentType="'+r.contentType+'" ',r.Extension&&(n+='Extension="'+r.Extension+'" '),r.PartName&&(n+='PartName="'+r.PartName+'" '),n+="/>\n"}return n+="</Types>"},t=function(t,n){var r=e(n);t.addFile(r,"[Content_Types].xml")},n=function(e,t,n,r){var o={name:e,contentType:t};for(var a in n)o[a]=n[a];r.contentTypes.push(o)},r=function(e){e.addContentType=null,delete e.addContentType,e.generateContent=null,delete e.generateContent,e.attach=null,delete e.attach,e.contentTypes=null,delete e.contentTypes};return{createContentType:function(){var o={contentTypes:[]};return o.addContentType=function(e,t,r){n(e,t,r,o)},o.generateContent=function(){return e(o)},o.attach=function(e){return t(e,o)},o.destroy=function(){r(o)},o}}}),n("oxml_sheet",[],function(){"use strict";var e=function(e,t){if(!e)return"";if("numeric"===e.type)return'<c r="'+t+'"><v>'+e.value+"</v></c>";if("sharedString"===e.type)return'<c r="'+t+'" t="s"><v>'+e.value+"</v></c>";if("sharedFormula"===e.type)return e.formula?'<c  r="'+t+'"><f t="shared" ref="'+e.range+'" si="'+e.si+'">'+e.formula+"</f></c>":'<c  r="'+t+'"><f t="shared" si="'+e.si+'"></f></c>';if("string"===e.type)return'<c r="'+t+'" t="inlineStr"><is><t>'+e.value+"</t></is></c>";if("formula"===e.type){var n=null!==e.value&&void 0!==e.value?"<v>"+e.value+"</v>":"";return'<c r="'+t+'"><f>'+e.formula+"</f>"+n+"</c>"}},t=function(t){var n=0,r="";if(t.values&&t.values.length)for(n=0;n<t.values.length;n++)if(t.values[n]&&t.values[n].length>0){r+='<row r="'+(n+1)+'">\n';var o=0;for(o=0;o<t.values[n].length;o++){var a=String.fromCharCode(65+o),s=t.values[n][o],l=a+(n+1),i=e(s,l);r+=i}r+="</row>"}return'<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"><sheetData>'+r+"</sheetData></worksheet>"},n=function(e,n){var r=t(e);n.addFile(r,"sheet"+e.sheetId+".xml","workbook/sheets")},r=function(e,t){if(void 0===e||null===e)return null;if("object"==typeof e){if(!(void 0!==e.value&&null!==e.value||e.formula&&"formula"===e.type))return null;if(e.type)return"sharedString"===e.type?"number"==typeof e.value?{type:e.type,value:e.value}:(e.value=t._workBook.createSharedString(e.value,t._workBook),{type:e.type,value:e.value}):"formula"===e.type?{type:e.type,formula:e.formula,value:e.value}:"numeric"===e.type||"string"===e.type?{type:e.type,value:e.value}:null;e=e.value}return"number"==typeof e?{type:"numeric",value:e}:"string"==typeof e?{type:"string",value:e}:"boolean"==typeof e?{type:"string",value:e+""}:null},o=function(e,t,n,o){n--,t.values[n]||(t.values[n]=[]);var a=0;for("object"==typeof e&&e.length||(e=[e]),a=0;a<e.length;a++){var s=r(e[a],t);s&&(t.values[n][a+o-1]=s)}},a=function(e,t,n,o){var a=0;for("object"==typeof e&&e.length||(e=[e]),a=0;a<e.length;a++){var s=r(e[a],t),l=a+n-1;t.values[l]||(t.values[l]=[]),s&&(t.values[l][o-1]=s)}},s=function(e,t,n,o){var a;for(a=0;a<e.length;a++)if(void 0!==e[a]||null!==e[a]){var s=a+n-1;if(t.values[s]||(t.values[s]=[]),"object"==typeof e[a]&&e[a].length>=0){var l;for(l=0;l<e[a].length;l++){var i=r(e[a][l],t);i&&(t.values[s][l+o-1]=i)}}else{var i=r(e[a],t);i&&(t.values[s][o-1]=i)}}},l=function(e,t,n,o){if(void 0!==e&&null!==e){var a=n-1;t.values[a]||(t.values[a]=[]),e=r(e,t),t.values[a][o-1]=e}},i=function(e,t,n,r){var o;if(n&&t&&r){var a=n.match(/\D+/)[0],s=n.match(/\d+/)[0];if(e._sharedFormula){o=e._sharedFormula[e._sharedFormula.length-1].si+1}else e._sharedFormula=[],o=0;e._sharedFormula.push({si:o,fromCell:n,toCell:r,formula:t});var l=a.toUpperCase().charCodeAt()-65,i=parseInt(s,10);e.values[i-1]||(e.values[i-1]=[]),e.values[i-1][l]={type:"sharedFormula",si:o,formula:t,range:n+":"+r};var u,c;if(r&&(u=r.match(/\D+/)[0],c=r.match(/\d+/)[0]),c===s){var f=u.toUpperCase().charCodeAt()-65;for(l++;l<=f;l++)e.values[i-1][l]={type:"sharedFormula",si:o}}else if(u===a){var d=parseInt(c,10);for(i++;i<=d;i++)e.values[i-1]||(e.values[i-1]=[]),e.values[i-1][l]={type:"sharedFormula",si:o}}return o}},u=function(e){delete e.sheetName,delete e.sheetId,delete e.rId,delete e.values,delete e._workBook,delete e._sharedFormula},c=function(e){return isNaN(e)||e<=0?1:e};return{createSheet:function(e,r,f,d){var h={sheetName:e,sheetId:r,rId:f,values:[],_workBook:d};return{_sheet:h,generateContent:function(){t(h)},attach:function(e){n(h,e)},updateValuesInRow:function(e,t,n){t=c(t),n=c(n),e&&o(e,h,t,n)},updateValuesInColumn:function(e,t,n){t=c(t),n=c(n),e&&a(e,h,t,n)},updateValuesInMatrix:function(e,t,n){t=c(t),n=c(n),e&&e.length&&s(e,h,t,n)},updateSharedFormula:function(e,t,n){return i(h,e,t,n)},updateValueInCell:function(e,t,n){return t=c(t),n=c(n),l(e,h,t,n)},destroy:function(){return u(h)}}}}}),n("oxml_workbook",["oxml_content_types","oxml_rels","oxml_sheet"],function(e,t,n){"use strict";var r=function(e){return e._rels.relations.length?e._rels.relations[e._rels.relations.length-1]:{}},o=function(e,t){var n,r='<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"><sheets>';for(n=0;n<e.sheets.length;n++)r+='<sheet name="'+e.sheets[n]._sheet.sheetName+'" sheetId="'+e.sheets[n]._sheet.sheetId+'" r:id="'+e.sheets[n]._sheet.rId+'" />',t&&e.sheets[n].attach(t);return r+="</sheets></workbook>"},a=function(e){if(e._sharedStrings&&Object.keys(e._sharedStrings).length){var t='<?xml version="1.0" encoding="UTF-8" standalone="yes"?><sst xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">';for(var n in e._sharedStrings)t+="<si><t>"+n+"</t></si>";return t+="</sst>"}return""},s=function(e,t){var o=r(e),a=parseInt((o.Id||"rId0").replace("rId",""),10)+1;t=t||"sheet"+a,e._rels.addRelation("rId"+a,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","sheets/sheet"+a+".xml");var s=n.createSheet(t,a,"rId"+a,e);return e.sheets.push(s),e.xlsxContentTypes.addContentType("Override","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",{PartName:"/workbook/sheets/sheet"+a+".xml"}),s},l=function(e,t){t._rels.attach(e);var n=o(t,e);e.addFile(n,"workbook.xml","workbook");var r=a(t);r&&e.addFile(r,"sharedstrings.xml","workbook")},i=function(e,t){if(e){if(!t._sharedStrings){t._sharedStrings={},t.xlsxContentTypes.addContentType("Override","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",{PartName:"/workbook/sharedstrings.xml"});var n=r(t),o=parseInt((n.Id||"rId0").replace("rId",""),10)+1;t._rels.addRelation("rId"+o,"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings","sharedstrings.xml")}return isNaN(t._sharedStrings[e])&&(t._sharedStrings[e]=Object.keys(t._sharedStrings).length||0),t._sharedStrings[e]}},u=function(e,t){return t._sharedStrings[e]},c=function(e){var t;for(delete e.xlsxContentTypes,delete e.xlsxRels,e._rels.destroy(),e._rels.destroy=null,delete e._rels.destroy,e._rels=null,delete e._rels,e.generateContent=null,delete e.generateContent,e.attach=null,delete e.attach,e.addSheet=null,delete e.addSheet,e.createSharedString=null,delete e.createSharedString,e.getSharedString=null,delete e.getSharedString,e._sharedStrings=null,delete e._sharedStrings,t=0;t<e.sheets.length;t++)e.sheets[t].destroy(),e.sheets[t].destroy=null,delete e.sheets[t].destroy,e.sheets[t]=null;e.sheets=null,delete e.sheets};return{createWorkbook:function(e,n){var r={sheets:[],xlsxContentTypes:e,xlsxRels:n};return r._rels=t.createRelation("workbook.xml.rels","workbook/_rels"),r.addSheet=function(e){return s(r,e)},r.generateContent=function(){return o(r)},r.attach=function(e){l(e,r)},r.createSharedString=function(e){return i(e,r)},r.getSharedString=function(e){return u(e,r)},r.destroy=function(){c(r)},r}}}),n("oxml_xlsx",["fileHandler","oxml_content_types","oxml_rels","oxml_workbook"],function(e,t,n,r){"use strict";var o={},a=function(t,n,r){try{var o=e.createFile();return r.contentTypes.attach(o),r._rels.attach(o),r.workBook.attach(o),o.saveFile(t,n)}catch(e){if(n)n("Err: Not able to create Workbook.");else if("undefined"!=typeof Promise)return new Promise(function(e,t){t("Err: Not able to create Workbook.")})}},s=function(){var e={};e.contentTypes=t.createContentType(),e.contentTypes.addContentType("Default","application/vnd.openxmlformats-package.relationships+xml",{Extension:"rels"}),e.contentTypes.addContentType("Default","application/xml",{Extension:"xml"}),e.contentTypes.addContentType("Override","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",{PartName:"/workbook/workbook.xml"}),e._rels=n.createRelation(".rels","_rels"),e._rels.addRelation("rId1","http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument","workbook/workbook.xml"),e.workBook=r.createWorkbook(e.contentTypes,e._rels);var o=function(t,n){if("undefined"==typeof JSZip)if(n)n("Err: JSZip reference not found.");else if("undefined"!=typeof Promise)return new Promise(function(e,t){t("Err: JSZip reference not found.")});return a(t,n,e)},s=function(){e.workBook.destroy(),delete e.workBook,e._rels.destroy(),delete e._rels,e.contentTypes.destroy(),delete e.contentTypes,e=null};return{_xlsx:e,addSheet:e.workBook.addSheet,download:o,destroy:s}};return o.createXLSX=s,window.oxml||(window.oxml=o),o}),t("oxml_xlsx")}()}(this);